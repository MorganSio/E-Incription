{% extends 'base.html.twig' %}

{% block title %}Info Etudiant{% endblock %}

{% block body %}
    {% for flash_error in app.flashes('verify_email_error') %}
        <div class="alert alert-danger" role="alert">{{ flash_error }}</div>
    {% endfor %}

    <main role="main" id="content">
        <form method="post" action="{{ path('fiche-etudiant') }}">
        <!-- Section 1 -->
        <article id="eleveFirst">
            <div class="fr-container fr-container--fluid fr-mb-md-14v">
                <div class="fr-grid-row fr-grid-row--gutters fr-grid-row--center">
                    <div class="fr-col-12 fr-col-md-10 fr-col-lg-8">
                        <div class="fr-container fr-background-alt--grey fr-px-md-0 fr-pt-10v fr-pt-md-14v fr-pb-6v fr-pb-md-10v">
                            <div class="fr-grid-row fr-grid-row--gutters fr-grid-row--center">
                                <div class="fr-col-12 fr-col-md-10 fr-col-lg-9">
                                    <h1 class="fr-h1">Info de l'Étudiant</h1>
                                    <div>
                                    <form Id="used to make it work"></form>
                                        <form class="fr-mb-0" id="etudiant-form">
                                            <fieldset class="fr-mb-0 fr-fieldset" id="etudiant-fieldset" aria-labelledby="representant-fieldset-legend-  ">
                                                <legend class="fr-fieldset__legend" id="etudiant-fieldset-legend-  ">
                                                    <h3 class="fr-h5">Étudiant</h3>
                                                </legend>
                                                <div class="fr-fieldset__element">
                                                    <p class="fr-hint-text">Veuillez remplir les informations ci-dessous.</p>
                                                </div>
                                                <div>
                                                <form class="fr-mb-0" id="student-info">
                                                    <fieldset class="fr-fieldset">
                                                        <legend class="fr-fieldset__legend"><h3 class="fr-h5">Informations de l'élève</h3></legend>
                                                        <!-- Numéro Sécurité Sociale -->
                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-secu">Numéro Sécurité Sociale</label>
                                                            <input class="fr-input" type="text" id="student-secu" name="student-secu" pattern="\d{15}" placeholder="15 chiffres" required>
                                                        </div>

                                                        <!-- Nationalité -->
                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-natio">Nationalité</label>
                                                            <input class="fr-input" type="text" id="student-natio" name="student-natio" required>
                                                        </div>

                                                        <!-- Contact élève -->
                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-mobile">Téléphone mobile</label>
                                                            <input class="fr-input" type="tel" id="student-mobile" name="student-mobile">
                                                        </div>

                                                        <legend class="fr-fieldset__legend"><h3 class="fr-h6">Date & Lieu de Naissance</h3></legend>
                                                        <!-- Date & Lieu de Naissance -->
                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-birthdate">Date de naissance</label>
                                                            <input class="fr-input" type="date" id="student-birthdate" name="student-birthdate" required>
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-birth-dept">Département de naissance</label>
                                                            <input class="fr-input" type="text" id="student-birth-dept" name="student-birth-dept" required>
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-birth-city">Commune de naissance</label>
                                                            <input class="fr-input" type="text" id="student-birth-city" name="student-birth-city" required>
                                                        </div>
                                                    </fieldset>
                                                    <fieldset class="fr-fieldset">
                                                        <!-- REPRÉSENTANT LÉGAL -->
                                                        <fieldset class="fr-fieldset">

                                                            <div class="fr-fieldset__element">
                                                                <h3 class="fr-h5">Étudiant en représentant légal</h3>
                                                                <p class="fr-text">Voulez-vous être votre propre représentant légal ?</p>
                                                                <div class="fr-radio-group">
                                                                    <input type="radio" id="student_legal_yes" name="student-legal" value="true">
                                                                    <label class="fr-label" for="student_legal_yes">Je me représente moi meme</label>
                                                                </div>
                                                                <p>
                                                                <div class="fr-radio-group">
                                                                    <input type="radio" id="student_legal_no" name="student-legal" value= "false">
                                                                    <label class="fr-label" for="student_legal_no">Autres représentants légaux (a définir dans la partie représentant legal))</label>
                                                                </div>
                                                            </div>

                                                            <div class="fr-fieldset__element">
                                                                <h3 class="fr-h5">Étudiant en représentant légal</h3>
                                                                <label class="fr-label" for="resp-comm">Autorisez-vous la communication de votre adresse aux associations de parents d'élèves ?</label>
                                                                <select class="fr-select" id="resp-comm" name="resp-comm">
                                                                    <option value="non">Non</option>
                                                                    <option value="oui">Oui</option>
                                                                </select>
                                                            </div>

                                                            <div class="fr-fieldset__element">
                                                                <label class="fr-label" for="resp-name">Adresse</label>
                                                                <input class="fr-input" type="text" id="resp-name" name="resp-name" placeholder="1 rue du lycée Fulbert" required>
                                                            </div>

                                                            <div class="fr-fieldset__element">
                                                                <label class="fr-label" for="resp-codepostal">Code Postal</label>
                                                                <input class="fr-input" type="text" id="resp-codepostal" name="resp-codepostal" placeholder="28000" required>
                                                            </div>

                                                            <div class="fr-fieldset__element">
                                                                <label class="fr-label" for="resp-firstname">Commune</label>
                                                                <input class="fr-input" type="text" id="resp-firstname" name="resp-firstname" placeholder="Chartres" required>
                                                            </div>

                                                            <div class="fr-fieldset__element">
                                                                <label class="fr-label" for="resp-email">Courriel</label>
                                                                <input class="fr-input" type="email" id="resp-email" name="resp-email">
                                                            </div>

                                                            <div class="fr-fieldset__element">
                                                                <label class="fr-label" for="resp-phone-dom">Téléphone domicile</label>
                                                                <input class="fr-input" type="tel" id="resp-phone-dom" name="resp-phone-dom">
                                                            </div>

                                                            <div class="fr-fieldset__element">
                                                                <label class="fr-label" for="resp-phone">Téléphone mobile</label>
                                                                <input class="fr-input" type="tel" id="resp-phone" name="resp-phone">
                                                            </div>

                                                            <div class="fr-checkbox-group">
                                                                <input type="checkbox" id="resp-sms" name="resp-sms">
                                                                <label class="fr-label" for="resp-sms">Accepter les SMS</label>
                                                            </div>
                                                        </fieldset>
                                                   </fieldset>

                                                    <!-- SCOLARITÉ -->
                                                    <fieldset class="fr-fieldset">
                                                        <legend class="fr-fieldset__legend"><h3 class="fr-h5">Scolarité</h3></legend>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-redoubling">Redoublement BTS</label>
                                                            <select class="fr-select" id="student-redoubling" name="student-redoubling">
                                                                <option value="non">Non</option>
                                                                <option value="oui">Oui</option>
                                                            </select>
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-transport">Transport scolaire</label>
                                                            <select class="fr-select" id="student-transport" name="student-transport">
                                                                <option value="non-transport">Non</option>
                                                                <option value="oui-transport">Oui</option>
                                                            </select>
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-transport">Transport scolaire</label>
                                                            <select class="fr-select" id="student-transport" name="student-transport">
                                                                <option value="bus-transport">Bus</option>
                                                                <option value="voiture-transport">Voiture</option>
                                                                <option value="train-transport">Train</option>
                                                                <option value="autre-transport">Autre</option>
                                                            </select>
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="immatriculation">N° d'immatriculation</label>
                                                            <input class="fr-input" type="tel" id="immatriculation" name="immatriculation" placeholder="AB-123-CD">
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-class">Classe (Niveau)</label>
                                                            <select class="fr-select" id="student-class" name="student-class">
                                                                <option value="1st">1ère année</option>
                                                                <option value="2nd">2ème année</option>
                                                            </select>
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-class">Classe (Spécialité)</label>
                                                            <select class="fr-select" id="student-class" name="student-class">
                                                                <option value="" selected disabled hidden> veuillez selectionner une option</option>
                                                                <option value="SIO">SIO (Services Informatiques aux Organisation)</option>
                                                                <option value="NDRC">NDRC (Négociation et Digitalisation de la Relation Client</option>
                                                                <option value="CG">CG (Comptabilité Gestions)</option>
                                                                <option value="MCO">MCO (Management Commercial Opératonnel)</option>
                                                            </select>
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-lv1">Langue LV1</label>
                                                            <select class="fr-select" id="student-lv1" name="student-lv1">
                                                                <option value="anglais">Anglais</option>
                                                            </select>
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <label class="fr-label" for="student-lv2">Langue LV2 (Optionnel)</label>
                                                            <select class="fr-select" id="student-lv2" name="student-lv2">
                                                                <option value="">pas de Lv2</option>
                                                                <option value="espagnole">Espagnol</option>
                                                            </select>
                                                        </div>

                                                        <div class="fr-table fr-table--bordered" id="table-bordered-component">
                                                            <div class="fr-table__wrapper">
                                                                <div class="fr-table__container">
                                                                    <div class="fr-table__content">
                                                                        <table id="table-bordered">
                                                                            <caption>Historique Scolaire</caption>
                                                                            <thead>
                                                                                <tr>
                                                                                    <th scope="col">Année Scolaire</th>
                                                                                    <th scope="col">Classe</th>
                                                                                    <th scope="col">Langue LV1</th>
                                                                                    <th scope="col">Langue LV2</th>
                                                                                    <th scope="col">Option</th>
                                                                                    <th scope="col">Établissement</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr>
                                                                                    <td data-label="Année Scolaire :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="annee-1" placeholder="2024/2025"></td>
                                                                                    <td data-label="Classe :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="classe-1" placeholder="SIO 2"></td>
                                                                                    <td data-label="Langue LV1 :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="lv1-1" placeholder="Anglais"></td>
                                                                                    <td data-label="Langue LV2 :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="lv2-1" placeholder="Espagnol"></td>
                                                                                    <td data-label="Option :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="option-1"></td>
                                                                                    <td data-label="Établissement :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="etablissement-1" placeholder="lycée Fulbert"></td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td data-label="Année Scolaire :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="annee-2" placeholder="2024/2025"></td>
                                                                                    <td data-label="Classe :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="classe-2" placeholder="SIO 2"></td>
                                                                                    <td data-label="Langue LV1 :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="lv1-2" placeholder="Anglais"></td>
                                                                                    <td data-label="Langue LV2 :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="lv2-2" placeholder="Espagnol"></td>
                                                                                    <td data-label="Option :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="option-2"></td>
                                                                                    <td data-label="Établissement :"><p><input class="fr-input" style="padding: 0rem 0rem;" type="text" name="etablissement-2" placeholder="lycée Fulbert"></td>
                                                                                </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="fr-fieldset__element">
                                                            <!-- Dernier diplôme obtenu -->
                                                            <p class="fr-text--bold fr-mt-4">Dernier diplôme obtenu :</p>
                                                            <input class="fr-input" type="text" name="last-certif">
                                                        </div>
                                                    </fieldset>

                                                    <div class="fr-fieldset__element">
                                                        <ul class="fr-mt-2v fr-btns-group fr-btns-group--right">
                                                            <li>
                                                                <button type="button" class="fr-btn" id="validateEtudiant">
                                                                    Valider Etudiant   
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </form>
                                            </fieldset>
                                        </form>
                                    </div>
                                    <hr>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        </form>
    </main>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // REPRESENTANT LEGAL
        const radioOui = document.getElementById('autorisation_oui');
        if (radioOui) {
            const parentFieldset = radioOui.closest('fieldset.fr-fieldset');
            if (parentFieldset) {
            parentFieldset.id = 'representant-legal-fieldset';
            }
        }
        
        const autorisationOui = document.getElementById('autorisation_oui');
        const autorisationNon = document.getElementById('autorisation_non');
        
        const representantLegalFieldset = document.getElementById('representant-legal-fieldset');
        
        if (representantLegalFieldset) {
            const representantLegalLegend = representantLegalFieldset.querySelector('legend.fr-fieldset__legend');
            const representantLegalFields = Array.from(representantLegalFieldset.querySelectorAll('.fr-fieldset__element, .fr-checkbox-group')).filter(el => {
            return !el.querySelector('.fr-radio-group');
            });
            
            function toggleFields() {
            if (autorisationOui.checked) {
                if (representantLegalLegend) {
                representantLegalLegend.style.display = 'block';
                }
                representantLegalFields.forEach(field => {
                field.style.display = 'block';
                });
            } else {
                if (representantLegalLegend) {
                representantLegalLegend.style.display = 'none';
                }
                representantLegalFields.forEach(field => {
                field.style.display = 'none';
                });
            }
            }
            
            if (representantLegalLegend) {
            representantLegalLegend.style.display = 'none';
            }
            representantLegalFields.forEach(field => {
            field.style.display = 'none';
            });
            
            autorisationOui.addEventListener('change', toggleFields);
            autorisationNon.addEventListener('change', toggleFields);
            
            if (autorisationOui.checked) {
            toggleFields();
            }
        }

        // TYPE DE TRANSPORTS
        const selects = document.querySelectorAll('#student-transport');
        if (selects.length > 1) {
            selects[1].id = 'transport-type';
        }

        const transportSelect = document.getElementById('student-transport');
        const transportTypeSelect = document.getElementById('transport-type');
        const immatriculationField = document.getElementById('immatriculation').closest('.fr-fieldset__element');
        const transportTypeContainer = transportTypeSelect ? transportTypeSelect.closest('.fr-fieldset__element') : null;
        
        function toggleTransportType() {
            if (transportTypeContainer) {
            if (transportSelect.value === 'oui-transport') {
                transportTypeContainer.style.display = 'block';
                toggleImmatriculation();
            } else {
                transportTypeContainer.style.display = 'none';
                immatriculationField.style.display = 'none';
            }
            }
        }
        
        function toggleImmatriculation() {
            if (transportSelect.value === 'oui-transport' && transportTypeSelect.value === 'voiture-transport') {
            immatriculationField.style.display = 'block';
            } else {
            immatriculationField.style.display = 'none';
            }
        }
        
        if (transportTypeContainer) {
            transportTypeContainer.style.display = 'none';
        }
        immatriculationField.style.display = 'none';
        
        transportSelect.addEventListener('change', toggleTransportType);
        if (transportTypeSelect) {
            transportTypeSelect.addEventListener('change', toggleImmatriculation);
        }
        
        toggleTransportType();
    });
    </script>
{% endblock %}